{% from "bootstrap.html" import css, custom_css %}

<!DOCTYPE html>
  <body>
    <div class="container">
      <div class="card">
        <div class="card-block">
          <table class="table table-bordered" aria-describedby="Sample table">
            <thead>
              <tr>
                <!-- <th>Prov</th> -->
                <!-- <th>Ankom</th> -->
                <!-- <th>Biblioteksberedning</th> -->
                <!-- <th>Beredd</th> -->
                <!-- <th>Sekvensering</th> -->
                <!-- <th>Sekvenserad</th> -->
                <th>Bioinformatisk analys</th>
              </tr>
            </thead>
            <tbody>
              {% for sample in case.samples %}
                <tr>
                  <!-- <td>{{ sample.name }}*</td> -->
                  <!-- <td>{{ sample.timestamps.received_at }}</td> -->
                  <!-- <td>{{ sample.methods.library_prep }}</td> -->
                  <!-- <td>{{ sample.timestamps.prepared_at }}</td> -->
                  <!-- <td>{{ sample.methods.sequencing }}</td> -->
                  <!-- <td>{{ sample.timestamps.reads_updated_at }}</td> -->
                  <td>{{ case.data_analysis.workflow }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="card-block">
          <table class="table table-bordered" aria-describedby="Case table">
            <thead>
              <tr>
                <th>Fall</th>
                <th>Rnafusion-version</th>
                <th>Genpaneler</th>
                <th>Genomversion</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{ case.name }}*</td>
                <td>{{ case.data_analysis.workflow_version }}</td>
                <td>{{ case.data_analysis.panels }}</td>
                <td>{{ case.data_analysis.genome_build }}</td>
              </tr>
            </tbody>
            <caption>
              <strong>Pipelineinformation och bioinformatiska verktygsversioner</strong>:
              <a href="https://nf-co.re/rnafusion">https://nf-co.re/rnafusion</a>
            </caption>
          </table>
        </div>

        <div class="card-block">
          <table class="table table-bordered" aria-describedby="Sample table">
            {% for sample in case.samples %}
              <tr>
                <th scope="col" colspan="8">Prov</th>
              </tr>
              <tr>
                <td colspan="8">{{ sample.name }}</td>
              </tr>
              <tr>
                <th scope="col">RIN</th>
                <th scope="col">Ingående mängd [ng]</th>
                <th scope="col">Läspar [M]</th>
                <th scope="col">Mappade sekvenser [%]</th>
                <th scope="col">Unikt mappade sekvenser [%]</th>
                <th scope="col">Duplikat [%]</th>
                <th scope="col">Adapter [%]</th>
                <th scope="col">5'-3' bias</th>
              </tr>
              <tr>
                <td>{{ sample.metadata.rin }}</td>
                <td>{{ sample.metadata.input_amount }}</td>
                <td>{{ sample.metadata.million_read_pairs }}</td>
                <td>{{ sample.metadata.mapped_reads }}</td>
                <td>{{ sample.metadata.uniquely_mapped_reads }}</td>
                <td>{{ sample.metadata.duplicates }}</td>
                <td>{{ sample.metadata.pct_adapter }}</td>
                <td>{{ sample.metadata.bias_5_3 }}</td>
              </tr>
              <tr>
                <th scope="col">Sekvenser som klarar filter [%]</th>
                <th scope="col">Genomsnittlig läslängd efter filtrering [bp]</th>
                <th scope="col">Q20-baser [%]</th>
                <th scope="col">Q30-baser [%]</th>
                <th scope="col">GC-innehåll [%]</th>
                <th scope="col">mRNA-baser [%]</th>
                <th scope="col">Ribosomala baser [%]</th>
              </tr>
              <tr>
                <td>{{ sample.metadata.pct_surviving }}</td>
                <td>{{ sample.metadata.mean_length_r1 }}</td>
                <td>{{ sample.metadata.q20_rate }}</td>
                <td>{{ sample.metadata.q30_rate }}</td>
                <td>{{ sample.metadata.gc_content }}</td>
                <td>{{ sample.metadata.mrna_bases }}</td>
                <td>{{ sample.metadata.ribosomal_bases }}</td>
              </tr>
            {% endfor %}
            <caption>
              <strong>Förklaringar</strong><br>
              <ins>RIN (RNA Integrity Number)</ins>: Mått på skala från 1 till 10 för kvalitet och integritet hos RNA-prover.<br>
              <ins>Ingående mängd [ng]</ins>: Mängd RNA som används för sekvensering.<br>
              <ins>Läspar [M]</ins>: Antal sekvenseringsläsningar i miljoner läspar.<br>
              <ins>Mappade sekvenser [%]</ins>: Procent sekvenser som matchar en eller flera positioner i referensgenomet.<br>
              <ins>Unikt mappade sekvenser [%]</ins>: Procentandel sekvenserade läsningar som endast matchar en position i referensgenomet.<br>
              <ins>Duplikat [%]</ins>: Sekvenseringsläsningar som är duplikat (kopior) och därmed ej unika sekvenser. Hög mängd duplikat kan tyda på dålig komplexitet av sekvenserat bibliotek eller djup sekvensering. Observera att dupliceringar är vanligt förekommande vid WTS.<br>
              <ins>Adapter [%]</ins>: Andel läsningar som innehåller adaptersekvenser.<br>
              <ins>5'-3' bias</ins>: Bias är förhållandet mellan antalet läsningar vid 3'-änden och antalet läsningar vid 5'-änden av fragmentet. Ett förhållande på 1 indikerar brist på bias, medan värden större eller mindre än 1 indikerar 3'- eller 5'-bias, respektive.<br>
              <ins>Sekvenser som klarar filter [%]</ins>: Procentandel läsningar som passerar kvalitetskontrollfilter.<br>
              <ins>Genomsnittlig läslängd efter filtrering [bp]</ins>: Genomsnittlig längd på läsningar som passerar kvalitetskontrollfilter.<br>
              <ins>Q20-baser [%]</ins>: Andel baser med en Phred-poäng på minst 20.<br>
              <ins>Q30-baser [%]</ins>: Andel baser med en Phred-poäng på minst 30.<br>
              <ins>GC-innehåll [%]</ins>: Andel guanin- och cytosinbaser i ett prov, beräknat på trimmade läsningar.<br>
              <ins>mRNA-baser [%]</ins>: Andel baser i ett prov som härstammar från budbärar-RNA.<br>
              <ins>Ribosomala baser [%]</ins>: Andel baser i ett prov som härstammar från ribosomalt RNA.<br>
            </caption>
          </table>

          <div class="card-body">* Information given av kund</div>
        </div>

        {% for application in case.applications %}
          <div class="card-block">
            <h4 class="card-title">
              Teknisk beskrivning av analysen: {{ application.tag }}
            </h4>
            <p class="card-text">{{ application.description }}</p>
            {% if application.details != 'N/A' %}
              <p class="card-text">{{ application.details }}</p>
            {% endif %}
            {% if application.limitations != 'N/A' %}
              <h4 class="card-title">
                Begränsningar av analysen: {{ application.tag }}
              </h4>
              <p class="card-text">{{ application.limitations }}</p>
              {% if application.workflow_limitations != 'N/A' %}
                <p class="card-text">{{ application.workflow_limitations }}</p>
              {% endif %}
            {% endif %}
          </div>
        {% endfor %}

        <div class="card-block">Ingen filtrering har utförts. Alla upptäckta varianter rapporteras.</div>

        <div class="card-block">Laboratoriet har inte haft ansvar för provtagningsstadiet och extraktion, resultaten gäller för provet såsom det har mottagits. </div>

      </div>
    </div>
  </body>
</html>
