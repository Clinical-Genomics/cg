<!-- Customer's order -->
{% macro order(case) %}
  <div class="container mb-5">
    <h3 class="mb-4">Beställning</h3>
    <table class="table w-auto text-center align-middle">
      <thead class="table-secondary">
        <tr>
          <th scope="col">Fall</th>
          <th scope="col">Bioinformatisk analys</th>
          <th scope="col">Prov</th>
          <th scope="col">Beställt</th>
          <th scope="col">Ticket</th>
          <th scope="col">Applikation</th>
          <th scope="col">Kön</th>
          <th scope="col">Provtyp</th>
          {{ sample_status(workflow=case.data_analysis.customer_workflow, sample=sample)}}
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row" rowspan="{{ case.samples | length + 1}}">
            {{ case.name }}
          </th>
          <td scope="row" rowspan="{{ case.samples | length + 1}}">
            {{ case.data_analysis.customer_workflow }}
          </td>
        </tr>
        {% for sample in case.samples %}
          <tr>
            <td>{{ sample.name }} ({{ sample.id }})</td>
            <td>{{ sample.timestamps.ordered_at }}</td>
            <td>{{ sample.ticket }}</td>
            <td>{{ sample.application.tag }}</td>
            <td>{{ sample.gender }}</td>
            <td>{{ sample.source }}</td>
            {{ sample_status_value(workflow=case.data_analysis.customer_workflow, sample=sample)}}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endmacro %}

<!-- Sample status -->
{% macro sample_status(workflow, sample) %}
  {% if "balsamic" in workflow or "rnafusion" == workflow %}
    <th scope="col">Tumör</th>
  {% elif "mip-dna" in workflow %}
    <th scope="col">Status</th>
  {% endif %}
{% endmacro %}

<!-- Sample status value -->
{% macro sample_status_value(workflow, sample) %}
  {% if "balsamic" in workflow or "rnafusion" == workflow %}
    <td>{{ sample.tumour }}</td>
  {% elif "mip-dna" in workflow %}
    <td>{{ sample.status }}</td>
  {% endif %}
{% endmacro %}